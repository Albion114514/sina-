#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
weibo_crawler_main.py â€” unified wrapper
Runs the mobile crawler implementation to ensure the actual scraping happens.
"""

import sys
import os
from pathlib import Path
import importlib.util

MOBILE_SCRIPT = Path("weibo_mobile_crawler_main.py")

def _import_from_path(path: Path, modname: str):
    spec = importlib.util.spec_from_file_location(modname, str(path))
    module = importlib.util.module_from_spec(spec)
    spec.loader.exec_module(module)  # type: ignore[attr-defined]
    return module

def main():
    if not MOBILE_SCRIPT.exists():
        print("âŒ æœªæ‰¾åˆ° weibo_mobile_crawler_main.pyï¼Œè¯·æŠŠç§»åŠ¨ç«¯çˆ¬è™«è„šæœ¬æ”¾åœ¨å½“å‰ç›®å½•")
        sys.exit(1)

    print("ğŸš€ ç»Ÿä¸€å…¥å£ï¼šå³å°†è°ƒç”¨ç§»åŠ¨ç«¯çˆ¬è™« weibo_mobile_crawler_main.py")
    try:
        mod = _import_from_path(MOBILE_SCRIPT, "weibo_mobile_crawler_main")
    except Exception as e:
        print("âŒ åŠ è½½ weibo_mobile_crawler_main.py å¤±è´¥ï¼š", e)
        sys.exit(1)

    # Prefer explicit main() if present; otherwise fall back to class API.
    if hasattr(mod, "main") and callable(getattr(mod, "main")):
        try:
            mod.main()
        except SystemExit as se:
            # Honor exit codes from the underlying script
            raise
        except Exception as e:
            print("âŒ æ‰§è¡Œ weibo_mobile_crawler_main.main() å¤±è´¥ï¼š", e)
            sys.exit(1)
    else:
        # Fallback: instantiate and run crawl_keywords()
        try:
            C = getattr(mod, "WeiboMobileCrawler", None)
            if C is None:
                print("âŒ æœªåœ¨ weibo_mobile_crawler_main.py ä¸­æ‰¾åˆ° WeiboMobileCrawler ç±»æˆ– main() å‡½æ•°")
                sys.exit(1)
            crawler = C()
            ok = crawler.crawl_keywords()
            if not ok:
                sys.exit(2)
        except Exception as e:
            print("âŒ æ‰§è¡Œç§»åŠ¨ç«¯çˆ¬è™«å¤±è´¥ï¼š", e)
            sys.exit(1)

if __name__ == "__main__":
    main()