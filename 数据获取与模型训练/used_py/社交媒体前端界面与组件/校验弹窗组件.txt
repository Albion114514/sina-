<!-- VerificationDialog.vue -->
<template>
  <el-dialog 
    :title="getDialogTitle()" 
    :visible="visible" 
    width="600px"
    :before-close="handleCancel"
  >
    <div v-if="currentItem" class="verification-dialog">
      <!-- 文本内容 -->
      <div class="text-section">
        <h4>文本内容：</h4>
        <div class="text-content">{{ currentItem.text }}</div>
      </div>
      
      <!-- 检测信息 -->
      <div class="info-section" v-if="operationType === 'process'">
        <p><strong>谣言概率：</strong>
          <span :class="getProbabilityClass(currentItem.rumor_probability)">
            {{ currentItem.rumor_probability }}%
          </span>
        </p>
        <p><strong>发布时间：</strong>{{ formatTime(currentItem.timestamp) }}</p>
        <p><strong>来源平台：</strong>{{ currentItem.source_platform }}</p>
      </div>
      
      <!-- 历史信息 -->
      <div class="info-section" v-if="operationType === 'modify'">
        <p><strong>当前标记：</strong>
          <el-tag :type="currentItem.nature === 'rumor' ? 'danger' : 'success'">
            {{ currentItem.nature === 'rumor' ? '谣言' : '非谣言' }}
          </el-tag>
        </p>
        <p><strong>处理时间：</strong>{{ formatTime(currentItem.process_time) }}</p>
        <p><strong>处理人：</strong>{{ currentItem.processor }}</p>
      </div>
      
      <!-- 校验选项 -->
      <div class="verification-options">
        <h4>请选择文本性质：</h4>
        <el-radio-group v-model="selectedNature" size="medium">
          <el-radio-button label="rumor">谣言</el-radio-button>
          <el-radio-button label="non-rumor">非谣言</el-radio-button>
        </el-radio-group>
      </div>
      
      <!-- 确认提示 -->
      <div class="confirmation-prompt" v-if="showConfirmation">
        <el-alert
          :title="getConfirmationText()"
          type="warning"
          :closable="false"
          show-icon
        />
      </div>
    </div>
    
    <div slot="footer" class="dialog-footer">
      <el-button @click="handleCancel">取消</el-button>
      <el-button 
        type="primary" 
        @click="handleConfirm"
        :disabled="!selectedNature"
      >
        {{ operationType === 'process' ? '确认处理' : '确认修改' }}
      </el-button>
    </div>
  </el-dialog>
</template>

<script>
export default {
  name: 'VerificationDialog',
  props: {
    visible: {
      type: Boolean,
      required: true
    },
    currentItem: {
      type: Object,
      default: null
    },
    operationType: {
      type: String, // 'process' or 'modify'
      default: 'process'
    }
  },
  data() {
    return {
      selectedNature: '',
      showConfirmation: false
    }
  },
  watch: {
    visible(newVal) {
      if (newVal && this.currentItem) {
        // 初始化选择
        this.selectedNature = this.operationType === 'modify' ? this.currentItem.nature : ''
        this.showConfirmation = false
      }
    },
    selectedNature(newVal) {
      // 当选择改变时显示确认提示
      this.showConfirmation = !!newVal
    }
  },
  methods: {
    getDialogTitle() {
      return this.operationType === 'process' ? '人工校验' : '修改校验结果'
    },
    
    getProbabilityClass(probability) {
      if (probability >= 90) return 'high-risk'
      if (probability >= 60) return 'medium-risk'
      return 'low-risk'
    },
    
    formatTime(timestamp) {
      if (!timestamp) return ''
      return new Date(timestamp).toLocaleString()
    },
    
    getConfirmationText() {
      const natureText = this.selectedNature === 'rumor' ? '谣言' : '非谣言'
      return `是否确认标记为"${natureText}"？此操作将${this.operationType === 'modify' ? '修改' : '确定'}文本性质。`
    },
    
    handleConfirm() {
      this.$emit('confirm', {
        nature: this.selectedNature
      })
    },
    
    handleCancel() {
      this.$emit('cancel')
    }
  }
}
</script>

<style scoped>
.verification-dialog {
  max-height: 60vh;
  overflow-y: auto;
}

.text-section {
  margin-bottom: 20px;
}

.text-content {
  padding: 10px;
  background: #f5f5f5;
  border-radius: 4px;
  max-height: 150px;
  overflow-y: auto;
  line-height: 1.5;
}

.info-section {
  margin-bottom: 20px;
}

.info-section p {
  margin: 8px 0;
}

.verification-options {
  margin: 20px 0;
}

.verification-options h4 {
  margin-bottom: 10px;
}

.confirmation-prompt {
  margin-top: 15px;
}

.high-risk {
  color: #ff4d4f;
  font-weight: bold;
}

.medium-risk {
  color: #faad14;
  font-weight: bold;
}

.low-risk {
  color: #52c41a;
}
</style>